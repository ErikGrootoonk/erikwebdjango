{% extends 'base.html' %}

{% block title %}FODMAP Lijst - erikweb{% endblock %}

{% block content %}
<div class="container mx-auto p-4 bg-cyan-600">
    <div class="mb-4">
        <input id="searchInput" type="text" placeholder="Zoeken..."
               class="w-full px-4 py-2 rounded-md shadow-md bg-white focus:outline-none focus:ring-2 focus:ring-cyan-400"/>
    </div>

    <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    fetch('{% url "api_fodmap" %}')
        .then(response => response.json())
        .then(data => {
            const gridDiv = document.getElementById('grid');
            const searchInput = document.getElementById('searchInput');

            const filterData = () => {
                const query = searchInput.value.toLowerCase().trim();
                const filteredData = data.filter(object => {
                    for (let key in object) {
                        if (object[key] && object[key].toString().toLowerCase().includes(query)) {
                            return true;
                        }
                    }
                    return false;
                });
                renderGrid(filteredData);
            };

            const renderGrid = (filteredData) => {
                gridDiv.innerHTML = '';

                filteredData.forEach(object => {
                    const card = document.createElement('div');
                    card.className = 'bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow';

                    for (let key in object) {
                        const column = document.createElement('div');
                        column.className = 'mb-2';

                        const heading = document.createElement('h2');
                        heading.className = 'text-sm font-semibold text-cyan-800 uppercase';
                        heading.textContent = key;
                        column.appendChild(heading);

                        const value = document.createElement('p');
                        value.className = 'text-gray-700';
                        value.textContent = object[key];
                        column.appendChild(value);

                        card.appendChild(column);
                    }

                    gridDiv.appendChild(card);
                });
            };

            searchInput.addEventListener('input', filterData);
            renderGrid(data);
        })
        .catch(error => console.error(error));
</script>
{% endblock %}
