{% extends 'base.html' %}

{% block title %}Filmlijst - erikweb{% endblock %}

{% block content %}
<div class="container mx-auto p-4 bg-cyan-600">
    <div class="mb-4">
        <input id="searchInput" type="text" placeholder="Zoeken..."
               class="w-full px-4 py-2 rounded-md shadow-md bg-white focus:outline-none focus:ring-2 focus:ring-cyan-400"/>
    </div>

    <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    fetch('{% url "api_films" %}')
        .then(response => response.json())
        .then(data => {
            const gridDiv = document.getElementById('grid');
            const searchInput = document.getElementById('searchInput');

            const filterData = () => {
                const query = searchInput.value.toLowerCase().trim();
                const filteredData = data.filter(object => {
                    for (let key in object) {
                        if (object[key] && object[key].toString().toLowerCase().includes(query)) {
                            return true;
                        }
                    }
                    return false;
                });
                renderGrid(filteredData);
            };

            const renderGrid = (filteredData) => {
                gridDiv.innerHTML = '';

                filteredData.forEach(object => {
                    const card = document.createElement('div');
                    card.className = 'bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow';

                    const title = document.createElement('h2');
                    title.className = 'text-xl font-bold text-cyan-800 mb-2';
                    title.textContent = `${object.titel} (${object.jaar || 'N/A'})`;
                    card.appendChild(title);

                    const director = document.createElement('p');
                    director.className = 'text-gray-600 mb-1';
                    director.innerHTML = `<span class="font-semibold">Regisseur:</span> ${object.regisseur}`;
                    card.appendChild(director);

                    if (object.acteurs) {
                        const actors = document.createElement('p');
                        actors.className = 'text-gray-600 mb-2 text-sm';
                        actors.innerHTML = `<span class="font-semibold">Acteurs:</span> ${object.acteurs}`;
                        card.appendChild(actors);
                    }

                    if (object.beschrijving) {
                        const desc = document.createElement('p');
                        desc.className = 'text-sm text-gray-700 mb-2 line-clamp-4';
                        desc.textContent = object.beschrijving;
                        card.appendChild(desc);
                    }

                    if (object.Taal) {
                        const lang = document.createElement('span');
                        lang.className = 'inline-block bg-cyan-100 text-cyan-800 text-xs px-2 py-1 rounded';
                        lang.textContent = object.Taal;
                        card.appendChild(lang);
                    }

                    gridDiv.appendChild(card);
                });
            };

            searchInput.addEventListener('input', filterData);
            renderGrid(data);
        })
        .catch(error => console.error(error));
</script>
{% endblock %}
