{% extends 'base.html' %}

{% block title %}Boekenlijst - erikweb{% endblock %}

{% block content %}
<div class="container mx-auto p-4 bg-cyan-600">
    <div class="mb-4">
        <input id="searchInput" type="text" placeholder="Zoeken..."
               class="w-full px-4 py-2 rounded-md shadow-md bg-white focus:outline-none focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400"/>
    </div>

    <div id="grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Load data from Django API
    fetch('{% url "api_boeken" %}')
        .then(response => response.json())
        .then(data => {
            const gridDiv = document.getElementById('grid');
            const searchInput = document.getElementById('searchInput');

            const filterData = () => {
                const query = searchInput.value.toLowerCase().trim();
                const filteredData = data.filter(object => {
                    for (let key in object) {
                        if (object[key] && object[key].toString().toLowerCase().includes(query)) {
                            return true;
                        }
                    }
                    return false;
                });

                const sortedData = sortData(filteredData, 'achternaam');
                renderGrid(sortedData);
            };

            const sortData = (data, key) => {
                return data.slice().sort((a, b) => {
                    const valueA = (a[key] || '').toLowerCase();
                    const valueB = (b[key] || '').toLowerCase();

                    if (valueA < valueB) return -1;
                    if (valueA > valueB) return 1;
                    return 0;
                });
            };

            const renderGrid = (filteredData) => {
                gridDiv.innerHTML = '';

                filteredData.forEach(object => {
                    const card = document.createElement('div');
                    card.className = 'bg-white p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow';

                    // Create a nice card layout
                    const title = document.createElement('h2');
                    title.className = 'text-xl font-bold text-cyan-800 mb-2';
                    title.textContent = object.titel;
                    card.appendChild(title);

                    const author = document.createElement('p');
                    author.className = 'text-gray-600 mb-2';
                    author.textContent = `${object.voornaam} ${object.achternaam}`;
                    card.appendChild(author);

                    if (object.beschrijving) {
                        const desc = document.createElement('p');
                        desc.className = 'text-sm text-gray-700 mb-2 line-clamp-4';
                        desc.textContent = object.beschrijving;
                        card.appendChild(desc);
                    }

                    if (object.Taal) {
                        const lang = document.createElement('span');
                        lang.className = 'inline-block bg-cyan-100 text-cyan-800 text-xs px-2 py-1 rounded';
                        lang.textContent = object.Taal;
                        card.appendChild(lang);
                    }

                    gridDiv.appendChild(card);
                });
            };

            searchInput.addEventListener('input', filterData);

            const sortedData = sortData(data, 'achternaam');
            renderGrid(sortedData);
        })
        .catch(error => console.error(error));
</script>
{% endblock %}
